<!DOCTYPE html>
<html>
<head>
  <title>Isle 10 World Records</title>
  <style>
    body { font-family: Arial; padding: 20px; background: #111; color: #fff; }
    .wr-box { background: #222; padding: 12px; border-radius: 8px; margin-bottom: 12px; }
    a { color: #4af; text-decoration: none; }
  </style>
</head>
<body>
  <h1>Roblox: Isle 10 — All World Records</h1>
  <div id="wrs"></div>

  <script>
    const usernameCache = {};

    async function getUsername(id) {
      if (usernameCache[id]) return usernameCache[id];
      const res = await fetch(`https://www.speedrun.com/api/v1/users/${id}`);
      const data = await res.json();
      const name = data.data.names.international;
      usernameCache[id] = name;
      return name;
    }

    async function loadWRs() {
      const res = await fetch("wr.json");
      let data = await res.json();

      // If it's a single category object, wrap it in an array
      if (!Array.isArray(data)) data = [data];

      const container = document.getElementById("wrs");

      for (const category of data) {
        const div = document.createElement("div");
        div.className = "wr-box";

        let runsHtml = "";
        for (const [subName, run] of Object.entries(category.runs)) {
          if (!run) {
            runsHtml += `<strong>${subName}</strong>: No WR yet<br>`;
          } else {
            const usernames = await Promise.all(run.players.map(getUsername));
            runsHtml += `<strong>${subName}</strong>: ${run.time} — Players: ${usernames.join(", ")} <a href="${run.weblink}" target="_blank">View Run</a><br>`;
          }
        }

        div.innerHTML = `<strong>${category.categoryName}</strong><br>${runsHtml}`;
        container.appendChild(div);
      }
    }

    loadWRs();
  </script>
</body>
</html>
