<!DOCTYPE html>
<html>
<head>
  <title>Isle 10 World Records</title>
  <style>
    body {
      font-family: Arial;
      padding: 20px;
      background: #111;
      color: #fff;
      margin-right: 320px;
    }

    .wr-box {
      background: #222;
      padding: 12px;
      border-radius: 8px;
      margin-bottom: 12px;
    }

    .lost { color: #f55; margin-top: 6px; }
    .gained { color: #5f5; margin-top: 6px; }

    a { color: #4af; text-decoration: none; }

    #side-panel {
      position: fixed;
      top: 20px;
      right: 20px;
      width: 280px;
      bottom: 20px;
      overflow-y: auto;
      background: #1b1b1b;
      border-left: 2px solid #333;
      padding: 15px;
      border-radius: 8px;
    }

    #changes-title {
      font-size: 20px;
      margin-bottom: 10px;
      border-bottom: 1px solid #333;
      padding-bottom: 4px;
    }
  </style>
</head>
<body>
  <h1>Roblox: Isle 10 — All World Records</h1>

  <div id="wrs"></div>

  <div id="side-panel">
    <div id="changes-title">Record Changes</div>
    <div id="changes"></div>
  </div>

  <script>
    const usernameCache = {};

    async function getUsername(id) {
      if (usernameCache[id]) return usernameCache[id];
      const res = await fetch(`https://www.speedrun.com/api/v1/users/${id}`);
      const data = await res.json();
      const name = data.data.names.international;
      usernameCache[id] = name;
      return name;
    }

    async function loadWRs() {
      const res = await fetch("wr.json");
      let data = await res.json();
      if (!Array.isArray(data)) data = [data];

      const container = document.getElementById("wrs");
      const changesContainer = document.getElementById("changes");
      changesContainer.innerHTML = "";

      const previousWRs = JSON.parse(localStorage.getItem("wrSnapshot") || "{}");
      const newSnapshot = {};

      for (const category of data) {
        const div = document.createElement("div");
        div.className = "wr-box";

        let runsHtml = "";
        for (const [subName, run] of Object.entries(category.runs)) {
          if (!run) {
            runsHtml += `<strong>${subName}</strong>: No WR yet<br>`;
            continue;
          }

          const usernames = await Promise.all(run.players.map(getUsername));
          runsHtml += `<strong>${subName}</strong>: ${run.time} — Players: ${usernames.join(", ")} <a href="${run.weblink}" target="_blank">View Run</a><br>`;

          const prevRunPlayers = previousWRs[category.categoryId]?.runs?.[subName]?.players || [];

          prevRunPlayers.forEach(prevPlayer => {
            if (!run.players.includes(prevPlayer)) {
              getUsername(prevPlayer).then(name => {
                const lostDiv = document.createElement("div");
                lostDiv.className = "lost";
                lostDiv.textContent = `${name} — ${subName} — lost`;
                changesContainer.appendChild(lostDiv);
              });
            }
          });

          run.players.forEach(currPlayer => {
            if (!prevRunPlayers.includes(currPlayer)) {
              getUsername(currPlayer).then(name => {
                const gainedDiv = document.createElement("div");
                gainedDiv.className = "gained";
                gainedDiv.textContent = `${name} — ${subName} — gained`;
                changesContainer.appendChild(gainedDiv);
              });
            }
          });
        }

        div.innerHTML = `<strong>${category.categoryName}</strong><br>${runsHtml}`;
        container.appendChild(div);

        newSna
